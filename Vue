<div id="SC02-03-010" class="containerR">
    <div id="EXAMPLE_SC02-03-010" class="container MobilePadding5" reload="true">
        <div class="col-xs-12 panelStyleA" id="SC0203010_Panel" v-show="returnControl">
            <div class="col-xs-12" style="text-align:center;">
                <h3 style="margin:15px">
                    <strong class="ubotlan">外幣餘額查詢</strong>
                </h3>
            </div>
            <div class="col-sm-8 col-sm-offset-2 col-xs-12 input-group" style="margin-bottom:1%;">
                <div class="col-xs-12 margin5px0px">
                    <div class="col-xs-12">
                        <span class="col-xs-12 col-sm-4  questionStyleA ubotlan">統編/戶名</span>
                        <select class="col-xs-12 col-sm-8 selectpicker"
                            v-model="selectValue">
                            <option class="ubotlan" value="">請選擇統編/戶名</option>
                            <option class="ubotlan" v-for="selectObject in selectList"
                                :value="{Code: selectObject.Code , Content: selectObject.Content}">{{ selectObject.Content }}
                            </option>
                        </select>
                    </div>
                    <span class="input-group-btn col-xs-12 col-sm-12"
                        style="display:flex; justify-content: center; width:100%; margin-top: 10px;">
                        <button class="btn btn-info SC0203010_cls ubotlan" action="Search"
                            @click="searchBtnClick()">查詢</button>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-sm-12">　</div>
        <!-- 空行 -->

        <div id="SC0203010_Detail" class="col-sm-12 MobilePadding0" v-show="detailControl">
            <div class="col-xs-12"
                style="background-color:#caffff;padding-top: 5px;padding-bottom: 5px;text-align:center;border-color:#00caca; border-style:solid;border-width:1px;">
                <div class="col-sm-6">
                    <span class="col-sm-12 ubotlan MobilePadding0" style="color:blue;padding-bottom: 5px;">統編/戶名</span>
                    <span class="col-sm-12" style="color:red" id="SC0203010_SpanId">{{taxIDName}}</span>
                </div>
                <div class="col-sm-6">
                    <span class="col-sm-12 ubotlan MobilePadding0" style="color:blue;padding-bottom: 5px;">查詢時間</span>
                    <span class="col-sm-12 MobilePadding0" style="color:red" id="SC0203010_SpanSearchTime">{{searchDate}}</span>
                </div>
            </div>
            <table id="SC0203010_MainTable" class="table table-bordered" style="text-align:center;">
                <thead>
                    <tr>
                        <th class='text-center ubotlan' data-field="No" data-sortable="true">序號</th>
                        <th class='text-center ubotlan' data-field="PayBranchName" data-sortable="true">分行別</th>
                        <th class='text-center ubotlan' data-field="PayAccountSubject" data-sortable="true">帳戶性質</th>
                        <th class='text-center ubotlan' data-field="PayAccount" data-sortable="true">帳號</th>
                        <th class='text-center ubotlan' data-field="PayAccountName" data-sortable="true">戶名</th>
                        <th class='text-right TableRight ubotlan' data-field="PayAccountBal" data-sortable="true">帳戶餘額
                        </th>
                        <th class='text-right TableRight ubotlan' data-field="PayAvailableBal" data-sortable="true">可用餘額
                        </th>
                        <th class='text-center ubotlan' data-field="PayCurrency" data-sortable="true">幣別</th>
                    </tr>
                </thead>
                <tbody id="SC0203010_tbody">
                </tbody>
            </table><br>
            <div class="col-sm-12" style="padding:5px;margin-bottom: 10px;">
                <button type="button" class="btn btn-info SC0203010_cls ubotlan_btn" action="Download">
                    <i class="fa fa-download"></i>　下載檔案
                </button>
                <button type="button" class="btn btn-primary SC0203010_cls ubotlan_btn" action="Print">
                    <i class="fa fa-print"></i>　列印此表
                </button>
            </div><br>
            <div class="col-sm-12">
                <b class="col-sm-12 ubotlan" style='color:red;'>注意事項</b>
                <b class="col-sm-12 ubotlan_long" style='color:blue;'>1.本項查詢結果不作為存款餘額證明。</b>
                <b class="col-sm-12 ubotlan_long" style='color:blue;'>2."-"為無查詢餘額權限。</b>
            </div>
        </div>

    </div>
</div>
<script>

    var SC0203010_MainTable_DataField = [];


    //vue化
    var SC02_03_010 = new Vue({
        el: "#SC02-03-010",
        data: {
            //頁面控制
            returnControl: true,
            detailControl: false,

            //下拉式選單資料
            selectValue: "請選擇統編/戶名",
            selectList: [
                    {
                        Code: "Code01",
                        Content: "Content01"
                    },
                    {
                        Code: "Code02",
                        Content: "Content02"
                    }
            ],
            
            //藍色預覽帳戶和查詢時間資訊
            taxIDName: "",
            searchDate: "",

        },
        methods: {
            beforeMount: function(){
                $('.selectpicker').selectpicker('refresh');
            },
            //初始化
            example_Init: function () {
                var self = this;
                self.returnControl = false;
                self.detailControl = false;

                var SendData = {
                    "cid": CID,
                    "loginUID": LID0,
                    "token": TK
                };

                loading();
                $.ajax({
                    url: UrlSearch("sc020301001"),
                    type: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    dataType: 'json',
                    data: JSON.stringify(SendData),
                    success: function (data) {
                        loadingEnd();
                        if (data.rc == "T23111") {

                            self.returnControl = true;
                            // $('#SC0203010_Panel').show();

                            var UserData = data.result.UserData;
                            console.log("UserData",UserData)

                            //這個不確定是不是放這
                            var options = [];
                            options.push('<option value="None">' + LRstr('請選擇統編/戶名') + '</option>');

                            //放入下拉式選單選項
                            for (var i = 0; i < UserData.length; i++) {
                                self.selectList.push({ id: UserData[i].Id, name: UserData[i].Name })
                                // options.push('<option value=' + UserData[i].Id + '>' + UserData[i].Id + '　' + UserData[i].Name + '</option>');
                            }

                            //vue的資料更新那麼及時，給個settime等一下
                            setTimeout(function () {
                                $('.selectpicker').selectpicker('refresh');
                            }, 200);

                        } else {
                            RcAndMsg(data.rc, data.msg);
                        }
                    }, error: function (jqXHR, exception) {
                        AjaxErrorHandle(jqXHR, exception, "sc020301001");
                    }, complete: function (xhr) {
                        loadingEnd();
                        if (this.returnControl)
                            $('#homePanel').click();
                    }
                });
            },
            SC020301002: function (account) {
                var SendData = {
                    "cid": CID,
                    "loginUID": LID0,
                    "token": TK,
                    "PayId": $('#SC0203010_Id').val()
                };
                loading();
                $.ajax({
                    url: UrlSearch("sc020301002"),
                    type: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    dataType: 'json',
                    data: JSON.stringify(SendData),
                    success: function (data) {
                        var self = this;
                        loadingEnd();
                        //這啥?
                        if (data.rc == "T23121") {
                            var SearchData = data.result;
                            for (var i = 0; i < SearchData.length; i++) {
                                SearchData[i].No = (i + 1);
                                SearchData[i].PayAccountBal = ForeignAmountProcessing(SearchData[i].PayAccountBal);
                                SearchData[i].PayAvailableBal = ForeignAmountProcessing(SearchData[i].PayAvailableBal);
                            }
                            //這啥? 應該是更新table
                            $('#SC0203010_MainTable').bootstrapTable('load', SearchData);
                            $('#SC0203010_MainTable thead .TableRight').removeClass("text-right").addClass("text-center");
                            
                            //查詢後的藍色區塊顯示               
                            self.detailControl = true;  
                            //套入藍色區塊的資訊(統編和查詢時間)
                            taxIDName = $('#SC0203010_Id').val()
                            searchDate = new Date().Format("yyyy/MM/dd hh:mm:ss")
                        } else {
                            //這啥?
                            InfoModalShow(data.msg + "(" + data.rc + ")");
                        }
                    }, error: function (jqXHR, exception) {

                        InfoModalShow(UBOTMessage("E00002"));
                    }, complete: function (xhr) {
                        loadingEnd();
                    }
                });
            },
             //按下查詢按鈕
             searchBtnClick: function () {
                var self = this;
                console.log("selectList",self.selectList)

                //如果查詢欄位值不為空，更新查詢
                if ($('#SC0203010_Id').val() != "None") {
                    $('#SC0203010_tbody').empty();
                    //重新執行查詢帳號餘額
                    SC020301002();
                } else//如果查詢欄位值為空 ????
                    InfoModalShow(LRstr('請選擇統編/戶名'));

            },
            mounted() {
                //將有用此套件的select初始化
                $('.selectpicker').selectpicker('refresh');

                $('#example_MainTable').bootstrapTable({
                    pagination: true, //使否要分頁
                    showColumns: true, //顯示/隱藏哪些欄位
                    search: true,//查詢
                    pageSize: 50, //一頁顯示幾筆
                    pageList: [10, 20, 50, 100], //一頁顯示幾筆的選項
                    formatRecordsPerPage: function (pageSize) {
                        return '&nbsp;&nbsp;每頁顯示　' + pageSize + '　筆';
                    },
                    formatShowingRows: function (fromIndex, toIndex, totalSize) {
                        var currentPage = Math.ceil(fromIndex / this.pageSize);//目前第幾頁
                        var totalPageCount = Math.ceil(totalSize / this.pageSize);//總共幾頁
                        return '第 ' + currentPage + ' 頁&nbsp;&nbsp;共 ' + totalPageCount + ' 頁';
                    }
                });

                this.example_Init();

            }
        }
    })
